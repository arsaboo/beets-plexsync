# Harmony Configuration
# Main library synchronization and playlist generation for Plex

plex:
  # Plex Media Server connection
  host: "192.168.1.100"          # IP address or hostname
  port: 32400                     # Default Plex port
  token: "${PLEX_TOKEN}"          # Plex API token (set via env var)
  library_name: "Music"           # Name of Plex Music library
  verify_ssl: true

beets:
  # Optional: beets library for enrichment (not required)
  library_db: "/path/to/beets/musiclibrary.blb"

providers:
  spotify:
    client_id: "${SPOTIPY_CLIENT_ID}"
    client_secret: "${SPOTIPY_CLIENT_SECRET}"
    redirect_uri: "http://localhost:8888/callback"
    scopes: "playlist-modify-private playlist-modify-public playlist-read-private"
    cache_path: "spotify_token.json"
  audiomuse:
    # Optional: AudioMuse enrichment for mood-based filtering
    base_url: "http://localhost:8001"
    enabled: false
    timeout: 30
    acoustic_enrichment: true
    cache_ttl_days: 7
  m3u8_dir: "C:/path/to/m3u8"

playlists:
  defaults:
    manual_search: false
    clear_playlist: true
  items:
    - id: daily_discovery
      name: "Daily Discovery"
      max_tracks: 50
      history_days: 15
      exclusion_days: 30
      discovery_ratio: 45
      filters:
        min_rating: 3
    - id: forgotten_gems
      name: "Forgotten Gems"
      max_tracks: 40
      exclusion_days: 60
    - id: energetic_workout
      name: "Energetic Workout"
      type: energetic_workout
      max_tracks: 40
      filters:
        mood:
          min_energy: 0.6
          min_tempo: 120
          min_danceable: 0.5
          max_sad: 0.3

  # Imported playlists from external sources
  imported:
    - name: "Spotify Favorites"
      enabled: false
      sources:
        - "https://open.spotify.com/playlist/YOUR_PLAYLIST_ID"
      manual_search: false
      max_tracks: 100

    - name: "YouTube Mix"
      enabled: false
      sources:
        - "https://www.youtube.com/playlist?list=YOUR_PLAYLIST_ID"
      manual_search: false

# AI/LLM Configuration (optional)
llm:
  enabled: false

  # LLM provider: "ollama" or "openai"
  provider: "ollama"

  # Model to use
  # For Ollama: "qwen3:latest", "llama2", "neural-chat", etc.
  # For OpenAI: "gpt-4", "gpt-3.5-turbo", etc.
  model: "qwen3:latest"

  # OpenAI API key (only needed for OpenAI provider)
  # api_key: "${OPENAI_API_KEY}"

  # OpenAI base URL (only for OpenAI-compatible providers)
  # base_url: "https://api.openai.com/v1"

  # Ollama settings
  ollama_host: "http://localhost:11434"

  # Enable LLM-enhanced search (Stage 4 in search pipeline)
  # When enabled, if no matches found, LLM will clean/enhance metadata and retry
  use_llm_search: false

  # Search provider configuration (required for use_llm_search)
  search:
    # Preferred order: searxng > exa > brave > tavily
    # At least one should be configured for LLM search features

    # SearxNG (privacy-focused, self-hosted)
    searxng_host: ""

    # Exa.ai (web search)
    exa_api_key: ""

    # Brave Search
    brave_api_key: ""

    # Tavily (research-focused)
    tavily_api_key: ""

# Search Configuration
search:
  # Use LLM to clean metadata and retry failed searches (requires llm.use_llm_search: true)
  use_llm_cleanup: false

  # Enable manual confirmation for ambiguous matches (similarity 0.0-0.8)
  # When enabled, you'll be prompted to confirm, skip, or manually search
  use_manual_confirmation: false

  # Similarity threshold for auto-accepting matches (0.0-1.0)
  # Matches below this threshold will be queued for confirmation (if enabled)
  similarity_threshold: 0.7

# Caching configuration (critical for performance)
cache:
  # Enable caching of search results to avoid repeated operations
  enabled: true

  # SQLite database for storing search results and metadata
  # Relative paths use workspace directory
  db_path: "harmony_cache.db"

  # Cache expiry configuration
  # Negative cache entries (tracks not found) are removed after this many days
  # This prevents stale "not found" results from permanently blocking tracks
  negative_cache_ttl: 7  # Default: 7 days

  # Playlist cache entries expire after this many hours
  # Playlists change less frequently than tracks, so longer TTL is acceptable
  playlist_cache_ttl: 168  # Default: 7 days (168 hours)

  # Cache maintenance options
  # Enable automatic cleanup of expired entries on startup
  auto_cleanup: true

  # Clear old format entries on startup (for migration from previous cache format)
  # Set to true once to clean old entries, then set back to false
  clear_old_format_on_startup: false

  # Vector index JSON file (rebuilt automatically if missing)
  vector_index_path: "harmony_vector_index.json"

# Logging configuration
logging:
  level: "INFO"        # DEBUG, INFO, WARNING, ERROR
  format: "%(asctime)s - %(name)s - %(levelname)s - %(message)s"

